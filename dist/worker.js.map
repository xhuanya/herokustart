{"version":3,"file":"worker.js","sources":["webpack://worker-typescript-template/./src/handler.ts","webpack://worker-typescript-template/webpack/bootstrap","webpack://worker-typescript-template/./src/index.ts"],"sourcesContent":["export async function handleRequest(request: Request): Promise<Response> {\r\n  return new Response(`request method: ${request.method}`)\r\n}\r\n\r\nexport async function handleScheduled(event: any) {\r\n  var flag = false;\r\n  var Runtask: Promise<Response>[] = [];\r\n\r\n  //任务队列\r\n  var taskList: any = await MykvDB.get('task', 'json') || []\r\n  if (taskList.length == 0) {\r\n    var allSite: any = await MykvDB.get('all', 'json') || []\r\n    console.log('空数据写入', '全部任务', allSite)\r\n    taskList = allSite\r\n  }\r\n  console.log(taskList)\r\n  for (var i = 0; i < 49; i++) {\r\n    let data = taskList[i]\r\n    if (!data) {\r\n      continue;\r\n    }\r\n    let now = new Date().getDate();\r\n    if (data.start < now && data.end > now) {\r\n      Runtask.push(new Promise(function(suc,fail){\r\n        fetch(data.url,{headers:{'User-Agent':'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.74 Safari/537.36 Edg/99.0.1150.46'},method:'GET'}).then(rs=>{\r\n          console.log('请求完成',data.url,rs)\r\n          suc(rs)\r\n        }).catch(err=>fail(err));\r\n      }))\r\n    }\r\n\r\n  }\r\n  if(taskList.length>50){\r\n    await MykvDB.put('task', JSON.stringify(taskList.splice(50)))\r\n  }\r\n\r\n  event.waitUntil( Promise.all(Runtask))\r\n}","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","import { handleRequest,handleScheduled } from './handler'\r\n\r\naddEventListener('fetch', (event) => {\r\n  handleScheduled(event)\r\n  event.respondWith(handleRequest(event.request))\r\n})\r\n\r\n\r\naddEventListener('scheduled', event => {\r\n  event.waitUntil(handleScheduled(event));\r\n});"],"mappings":";;;;;;;;;;;;;AAAA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAjCA;;;A;;;;ACJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACvBA;AAEA;AACA;AACA;AACA;AAGA;AACA;AACA;;;;;A","sourceRoot":""}